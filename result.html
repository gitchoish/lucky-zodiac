<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1 data-i18n="title">ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼</h1>
    <div id="fortuneText">Loading...</div>

    <div id="fortuneAI" style="margin-top:2rem; padding:1rem; background:#f0f0f0; border-radius:8px;">
      AI ìš´ì„¸ ë¶„ì„ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...
    </div>

    <a href="index.html" data-i18n="back">ğŸ”™ ë‹¤ì‹œ ì…ë ¥</a>
    <br><br>

    <select id="language" onchange="setLanguage(this.value)">
      <option value="ko">í•œêµ­ì–´</option>
      <option value="en">English</option>
    </select>
  </div>

  <script src="lang.js"></script>
  <script src="script.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const dateStr = params.get("date");            // ìƒë…„ì›”ì¼ (YYYY-MM-DD)
    const timezone = params.get("timezone");        // ì˜ˆ: Asia/Bangkok
    const hourBranch = params.get("branch");        // ì˜ˆ: å­

    if (dateStr && timezone && hourBranch) {
      // 1. ì‚¬ìš©ìì˜ í˜„ì§€ ë‚ ì§œ â†’ Date ê°ì²´ë¡œ ë³€í™˜
      const localDate = new Date(`${dateStr}T12:00:00`); // ì •ì˜¤ë¡œ ì„¤ì • (ì‹œê°ì€ ì§€ì‹œë¡œ ê²°ì •ë˜ë¯€ë¡œ)

      // 2. í˜„ì§€ ì‹œê°„ â†’ UTC â†’ KST
      const utcDate = new Date(localDate.toLocaleString('en-US', { timeZone: 'UTC' }));
      const koreaDate = new Date(utcDate.toLocaleString('en-US', { timeZone: 'Asia/Seoul' }));

      const birthDateKST = koreaDate.toISOString().slice(0, 10);  // YYYY-MM-DD

      // 3. ë¶„ì„ í•¨ìˆ˜ í˜¸ì¶œ (ì „í†µ ì‹œê° ê·¸ëŒ€ë¡œ ì „ë‹¬)
      analyzeSaju(birthDateKST, hourBranch);
    } else {
      document.getElementById("fortuneText").innerText = "ì…ë ¥ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.";
    }

    // ë‹¤êµ­ì–´ ì²˜ë¦¬
    window.onload = () => {
      const lang = localStorage.getItem("lang") || "ko";
      document.getElementById("language").value = lang;
      applyTranslations(lang);
    };
  </script>
</body>
</html>
